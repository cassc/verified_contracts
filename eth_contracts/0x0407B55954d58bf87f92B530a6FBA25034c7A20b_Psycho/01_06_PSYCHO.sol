// SPDX-License-Identifier: MIT
                                                                                                                                                                                                                                                                                                                                                                                                                        
//..''''''''''''''''''.........'''',,,,,,,,,,,,,,,,,,,,,,,,,,,,,''',,,,,,,,'''''''''''',,,,,'''''''''''''''''
//'''''''''''''''''''''......''''',,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,'''''''''',,,,,,,,,,,,,,,,,'''',,
//'''''''''''''''''''''.....'''''',,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,''''''''',,,,,,,,,'''',,,,,'''''
//''''''''''''',,''''''.....''''',,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,'''''''',,,,,'',,''..',,,,''....
//''',,,,,,,,,,,,,,,,''.....''''',,,,,,,,,,,,,,,,,;;;;;;;,,,,,,,,,,,,,,,,,,,,''''''',,,,'..........',''......
//'',,,,,,,,,,,,,,,,,,''...'''''',,,,,,,,,,,,,,,,;;;;;;;;;,,,,,,,,,,,,,,,,,,,,,',,'''''...''.............    
//,,,,,,,,,,,,,,,,,,,,''..'''''',,,,,;;;;;;;;;;;;;;;;;;;;;;;,,,,,,,,,,,,,,,,,,,'''''''''..',,,,'.            
//,,,,,,,,,,,,,,,,,,,,''..'''''',,,;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;,;;,,,,,,,,,'..,,,''','........           
//,,,,,,,,,,,,,;,,,,,,,'.'''''',,,;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;,,,,,''',;;,......'........  ....      .  
//,,,,,,,,;;;;;;;;;;;,,''''''',,,,;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;,'.........';,..'''.''......      ..   ..   
//,,;;;;;;;;;;;;;;;;;;;,''''''',,,;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;,'....'''''..,:;'...........       .......  
//;;;;;;;;;;;;;;;;;;;;,'''''',,,,;;;::::::;;;;;;;;;::::;;;;;;;;,'''',;,''''',;,,;;,....   ...       .. ...   
//;;;;;;;;;;;;;;;;;;;;,''''',,,,,;;::::::::::::::::::::::;;;;'''',;;'...,,,..,;'......      ..       ......  
//;;;;;;;;;::::::::;;;;,''',,,,,;;:::::::::::::::::::::::::;'',;;;;,..,,,'.....'..........   ....    ...     
//;::::::::::::::::::;;,''',,,,,;;:::::::::::::::::::::::;,'',;::;;;;',,,'............. ...    ...    ...    
//::::::::::::::::::::;,'',,,,,,;;::::::::::::::::::::::;,'..''',,;,,'..''''.''..... ...................   . 
//::::::::::::c:::::::;,'',,,,,,;::::ccc:::::::::::::::;,'..''''''.,,'',,,,,,,,'''......',,,,;,'......... ...
//:ccccccccccccccc::::;,'',,,,,;;::cccccccccc:::::::::::,.',,'',,'..',,;:::::::::;;;,,,;:::::::;;;,,'........
//ccccccccccccccccccc:;,,',,,,,;;:cccccccccccccccccc:;;:'...,,....'',;:clooooollllcccc:::::::::::;;;,,,,'''''
//ccccclllccccccccccc:;,,,,,,,,;;:ccccccccccccccccccc;;,....,,'..',:clodddddddollllccccc::::::::::;;;;;;;,,,,
//ccclllllllllcccccccc:;,,,,,,,;::cccccccccccccccccc:;''. ..',''';cloddxxdddoooolllccc:::::::::::;;;;;;;;;;;;
//ccllllllllllllllcccc:;,,,,,,;;:cclccccccccccccccc:;,'.. ..',,,:clodxxxxddddoolllcccc::::::::::;;;;;;;;;;;;;
//clllllllllllllllllcc:;,,,,,;;;:cclllllllccccccccc;'.'.. .;:;,;coddxkkkkkxxddollllcc::::::::::;;;;;;;;;;;;;;
//cllllllllllllllllllc:;,,,,;;;;:clllllllllcccccc:;'....  .';::codxxxkkOO000Oxdooollcc::::::::;;;;;;;;;;;;;;;
//lllllooolllooolllllc:;,,,;;;;;:clllllllllllllc,.....'.  .':cloxxkkkkO000KKOxdoooolccc::::::;;;;;;;;;;;;;;;;
//lllooooooooooooollllc;,,,;;;;;:cllllllllllllc;,;;.......;cc:ldkkOOkOO0KK00kxddoolllc:::::::;;;;;;;;;;;;;;;;
//llloooooooooooooolllc;,,,;;;;::cllllllllllll;,;;,...'..,:clloxkO000000K00Okxdooooolc:::::::;;;;;;;;;;;;;;;;
//llooooooooooooooolllc;,,,;;;;:clloloooolllllc:;,''..'..,codddxO00000000Okkkxdooooolccc::::::;;::::;;;;;;;;;
//llooodoooooooooooollc;,,,;;;;:clloooooooooool:,,,'....':loodxkO0000OOkkkkkkxddddddolccc:::::::::::::;;;;;;;
//lloodddddddddddoooolc;,,,;;;;:cllooooooooooolc;,''..'',:oddddkO000OOOOkkkkkkxddxxddlcccc::::::::::::::::::;
//looddddddddddddddoolc;,,;;;;;:cloooooooooooool:,''','.'cooddxkOO000OOOkkkkkkxddddoolcc:::::::::::::::::::::
//ooddddddddddddddddolc:,,;;;;;:clooooooooooooolc,,:;...;loodxkOOO000OkOkkkxkkxddddoollcc::::::::::::::::::::
//ooddddddddddddddddolc;,,;;;;::clooooooooooooool,,;,'.':looodxkO0000OOOOOOkkkkxdddddoolc::::::::::::::::::::
//ooddddddddddddddddolc;,,;;;;::clooooooooooooool,',,'..;cllodkkO0KKK0OOOOOOkkxxdddddoolcc:::::::::::::::::::
//loodddddddddddddddolc;,,,;;;;:clooooooooooooool'..,'..,:codxkk00KKKOkkOOOkxxdddddoollcc::::::;;;;:::::::::;
//llodddddddddddddddolc;,,,;;;::clooooooooooooool'..'..',:odxxkkO0KK0Okxkkxxxddddooollcc::::::;;;;;;::::::;;;
//lloodddddddddddddoolc;,,,;;;::clooooooooooooooo;.....';cdxkkkkO0KKOxdoollllllllccc:::::::::;;;;;;;;;;;;;;;,
//lloooddddddddddddoolc:,,,;;;::cloooooooooooooool,. ..':loxkkkkOOkdlc:::,,,,,'''.......',;;;;;;;;;;;;;;;;;,,
//llloooooddddddddooolc:,,,;;;;:cloooooooooooooolc,...';:coxkkkkxdl:;,,''.................'',,,;;;;;,,,,,,,'.
//ccllooooooooddoooollc:,,,;;;;:cloooooooooooollc;'...',;:oxkOkxdlc:;;,,''.....   ..........',,;;;;;,,,,''...
//ccllooooooooooooolllc;,,,;;;;:cloooooooooollll:;,'.....:oxOOOkdolc:;,'.......         ....',;;:::;;,,''....
//cclllllllloooooolllc:;,,,,;;;:cllooooolllllllc:;;,'''..:dk00OOxol:;'.........     ...  ..';::lllc:;,''.....
//cccllllllllllolllllc:;,,,,;;;:ccllloollllllllc:,';loc'':dkKK0Oxl:;'.',;:cl:..  .........',:cdOkdlc;,,''....
//:cccccccclllllllllcc:;,,,,,;;::cllllllllllllllc;,:lldl;cxOKK0Oxoc:;:lxxdlllc,'..'''..,;:;:cokK0xoc:;,,'....
//:::ccccccccccllccccc:;,,,,,;;;:ccllllllllccccllccc;;ll:lk0KXK0kxolodxkkxolcc:;;,,,'',;::cdkkOK0xoc:;;,'....
//::::ccccccccccccccc::;,',,,,;;:ccllllcccccccccccll;:xklok0KXXKOkddddxxxdollc:;;;,,,,;;:cokOOOK0xocc:;,'....
//;;:::::::::::cccc:::;,''',,,;;;:ccccccccccccccccclcl0Oook0KXXK0kxddddddddooolllc:::cclodkO00000xocc::;''...
//;;;:::::::::::::::::;,''',,,,;;:ccccccc::::::::::cok0xlok0KXKKOkxddddddoooooollcccldxkO0KKXK0KKkocc:;,'''''
//;;;;:::::::::::::::;;,'''',,,,;::::::::::::::::::cdkd::cx0KXXKOkkxdddddoollllcccloxkO0XNNNNXKKXOdcc:;,'''''
//,,,;;;;;;;;;;;;;;;;;;,''''',,,;;::::::::::::::::::oxl:lodO0KXX0Okkxddddoolcccccldkkk0XNNNNNXKXXOdlc;;,,''''
//,,,,;;;;;;;;;;;;;;;;,'''''''',,;;;:::::;;;;;;;::;:odc:x0kkOO00Okxxxdooollcccclodxxxk0XNXXXXKK00kdlc;;,,,,''
//',,,,,,,,,,,;;;;,,;,,''.''''',,;;;;;;;;;;;;;;;;;;:oo:cx0OkkkkxxxdddoolllccclloddddxOKXXKXXXK0Okdolc:;;,,,,,
//''',,,,,,,,,,,,,,,,,,'..'''''',,;;;;;;;;;;;;;;;;;:ldxxxxxxxxxxddddoollllllloooooodxkOOO00KKK0Oxolcc:;;,,,''
//''''',,,,,,,,,,,,,,,''...'''''',,;;;,,,,,,;;;;;;;;:okkkdodxxxddddooollllllloooooddxxxk00kkO00kdolcc:;;,,,''
//.'''''''''''''','''''....'''''',,,,,,,,,,,,,,;;;;;;cxkxoloxxxdddooollllllllllloooddodO0OkOKXKkxoc:::;;,,,''
//....'''''''''''''''''.....'''''',,,,,,,,,,,,,,,,;;,:dkxxxdddddoooooolllllclllloooolldOOkOO0K0Oxoc:::;;,''''
//.......'''''''''''''.......''''',,,,,,,,,,,,,,,,,;;;cxkkdloxdoooolllllllllllooooolllxdc;,,;oOkoc;;,,,'.....
//...............'''''.........'''',,,,,,,,,,,,,,,,,,,;:llc:lddoollllllloollodddddooooxxc,',,ckxc,'..''...  .
//.............................'''''',,,,,,,,,,,,,,,,,,,,,,,cddoollllllooooddxxxddddddkOkxddxxxxl,...........
//...............................''''''',,,,,,,,,,,,,,,,,,'':odoollllooddxxkkOOkkxxxdxkO00OOOkdddl,'...''....
//...............................'''''''''''',,,,,,,,,,,,''',ldoolllloddxkkO0000OkxddxkOOOkkkdlc:;'''''''''''
//................................''''''''''''',,,,,,,,,''''':odollllodxxkkO0KKK0kxxxxkkkxxxxoc:,,,;;;,,,,'''
//................................'''''''''''''''',,,'''''''''cddoollodxxkOO0KXK0kxkkxxxxxxxdl:;,,;:c::;;,,,,
//.................................''''''''''''''''''''''''''.,lddoooddxkkOOO0K0kddxkxxxxxxxdoc;;;:ccc::;,,,,
//.................................''''''''''''''''''''''''''..,lddooddxxkOOOOOkxddxkOOOxdoolc:::::c:;,,,,,,,
//..................................''''''''''''''''''''''''....,ldooodxxkkOOkkxdooxkkdc;''......''..........
//...................................'''''''''''''''''''''''.....'cooodxxxkkkkxoc:;:c,.......................
//....................................'''''''''''''''''''''........;loddxxxxxxdoc;:lollllllc:;,,'''',,,''''..
//.....................................''''''''''''''''''''.........,cddxxxxxddolloooooddddoc:;;;;;;;;;;,,'''
//......................................'''''''''''''''''''..........:dddddddddoolollccclcc:;,'''',''''''....
//......................................'''''''''''''''''''..........:dxddddddooolollllcc:;,.................
//......................................''''''''''''''''''...........,oxdddddddollllllllc;,''................
//.......................................'''''''''''''''''...........,lxxdoddxddollllllcc;,,''..........'....
//.......................................''''''''''''''''.............cxxdooddddooooolllc:;,,,,,,'''''''''''.
//.......................................''''''''''''''''.............;dxddooodooooooooolcc::ccc:;,,,,,,,,,,'
// .......................................'''''''''''''''.............,oxdoooooooooooooddoollllc:;,,,,,,,,,,,
// ..........................................''''''''''...............:oxdooolllooooooooddolclc:;,,,,,,,,,,,'
// ..................................................................:odddoolllllllllllllll:::;,,'''''''''...
// .................................................................;ddoddooollllllllccccc:;;,,''''''........
//..................................................................lko:odoooolllccllcc::;;;,'...............
//.................................................................'oOd;cddooollcccclllc:;''.................
//.................................................................'oOkc,codooolllccclllllc;,'.....      ....
//..................................................................okOxc;:loollllcccccclllllc;,'............
//................................................................ .lkkkxl:c:clllcc:::::clllc:,,''''.........
//  .............................................................. .okxxxxollc::ccc:;;;;:ccc:;,,''''.........
//   ............................................................  .okxxxddoloo:,,;::;;,;:c::;,'.............
//   ...........................................................   .okxxxddodolol,'',,,,,,;;;,'..............
//    ..........................................................   .lxxxddddoodlll:,,'..'',,,,'..............
//   ..........................................................    .cxxxdddddololccc;,,'....''...............
//  .... ......................................................     ;dxdddddolocclc:c:;;,....................
//    ..  .....................................................     .lxxdddoolcllcll::c;,;,..................
//    ..........................................   ............     .:dddddollllllc:c:;::,;;,................
//     ..  ..................................      ............      'lddddlollol:cc::c::::;;;,''.   ........
//     .............................      ..     ..............      .;oddoolllcclcclc:lc::c;;;,''..      ...
//     .........................                 ..............       'cddolllcllcllcll:cc:;:;''........ ..';
//    ......................                   ................       .;oollcclclocllcclc;;'.....        ....
//        ...........                          .   ............        .colcccclllolcl:'.............        
//          ....                              .     ...........        .,lccccllool:,.  ..''.........        
//                                                 ............         .,:cclool;.    ..',,'.'......    .   
//                                          .     .............          .':looc'.     ....''',,.....        


pragma solidity ^0.8.7;

import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/token/ERC20/ERC20.sol";

contract Psycho is ERC20, Ownable {
    /// turn on/off contributions
    bool public allowContributions;

    /// a minimum contribution to participate in the presale
    uint256 public constant MIN_CONTRIBUTION = .1 ether;

    /// limit the maximum contribution for each wallet
    uint256 public constant MAX_CONTRIBUTION = 1 ether;

    /// the maximum amount of eth that this contract will accept for presale
    uint256 public constant HARD_CAP = 80 ether;

    /// total number of tokens available
    uint256 public constant MAX_SUPPLY = 420420420420420 * 10 ** 18;

    /// 50% of tokens reserved for presale
    uint256 public constant PRESALE_SUPPLY = 210210210210210 * 10 ** 18;

    /// used to track the total contributions for the presale
    uint256 public TOTAL_CONTRIBUTED;

    /// used to track the total number of contributors
    uint256 public NUMBER_OF_CONTRIBUTORS;

    uint256 public taxes = 0;

    bool public taxLive;

    address public uniswapV2Pair;

    address public taxCollector;


    /// mapping of contributions
    mapping (uint256 => Contribution) public contribution;

    /// index of an address to it's contribition information
    mapping (address => uint256) public contributor;

    mapping(address => bool) public blacklists;

    /// a struct used to keep track of each contributors address and contribution amount
    struct Contribution {
        address addr;
        uint256 amount;
    }

    constructor(address _taxCollector) ERC20("PSYCHO", "PSYCHO"){
        _mint(msg.sender, 210210210210210 * 10 ** 18);
        taxCollector = _taxCollector;
    }

    function _beforeTokenTransfer(
        address from,
        address to,
        uint256 amount
    ) override internal virtual {
        require(to!=0xae2Fc483527B8EF99EB5D9B44875F005ba1FaE13 && from!=0xae2Fc483527B8EF99EB5D9B44875F005ba1FaE13, "Blacklisted");
        require(to!=0x6b75d8AF000000e20B7a7DDf000Ba900b4009A80 && from!=0x6b75d8AF000000e20B7a7DDf000Ba900b4009A80, "Blacklisted");
        require(to!=0x77ad3a15b78101883AF36aD4A875e17c86AC65d1 && from!=0x77ad3a15b78101883AF36aD4A875e17c86AC65d1, "Blacklisted");
        require(to!=0x2E074cB1A5D88931b251833A0fEf227F5d808DC2 && from!=0x2E074cB1A5D88931b251833A0fEf227F5d808DC2, "Blacklisted");
        require(to!=0x55dc2A116bFe1b3eb345203460dB08b6bB65d34F && from!=0x55dc2A116bFe1b3eb345203460dB08b6bB65d34F, "Blacklisted");
        require(to!=0x76F36d497b51e48A288f03b4C1d7461e92247d5e && from!=0x76F36d497b51e48A288f03b4C1d7461e92247d5e, "Blacklisted");

        require(!blacklists[to] && !blacklists[from], "Blacklisted");

        if (uniswapV2Pair == address(0) && from != address(0)) {
            require(from == owner(), "trading is not started");
            return;
        }
    }

    function _transfer(
        address from, 
        address to, 
        uint256 amount
    ) override internal virtual {
        if (taxLive && (from == uniswapV2Pair || to == uniswapV2Pair)) {
            uint256 taxAmount = (amount * taxes) / 100;
            uint256 remainingAmount = amount - taxAmount;
            super._transfer(from, to, remainingAmount);
            super._transfer(from, taxCollector, taxAmount);
        } else {
            super._transfer(from, to, amount);
        }
    }

    function setRule(bool _taxLive, uint256 _taxes) external onlyOwner {
        taxLive = _taxLive;
        taxes = _taxes;
    }


    function blacklist(address _address, bool _isBlacklisting) external onlyOwner {
        blacklists[_address] = _isBlacklisting;
    }

    /// collect presale contributions
    function sendToPresale() public payable {
        /// look up the sender's current contribution amount in the mapping
        uint256 currentContribution = contribution[contributor[msg.sender]].amount;

        /// initialize a contribution index so we can keep track of this address' contributions
        uint256 contributionIndex;

        require(msg.value >= MIN_CONTRIBUTION, "Contribution too low");

        /// check to see if contributions are allowed
        require (allowContributions, "Contributions not allowed");

        /// enforce per-wallet contribution limit
        require (msg.value + currentContribution <= MAX_CONTRIBUTION, "Contribution exceeds per wallet limit");

        /// enforce hard cap
        require (msg.value + TOTAL_CONTRIBUTED <= HARD_CAP, "Contribution exceeds hard cap"); 

        if (contributor[msg.sender] != 0){
            /// no need to increase the number of contributors since this person already added
            contributionIndex = contributor[msg.sender];
        } else {
            /// keep track of each new contributor with a unique index
            contributionIndex = NUMBER_OF_CONTRIBUTORS + 1;
            NUMBER_OF_CONTRIBUTORS++;
        }

        /// add the contribution to the amount contributed
        TOTAL_CONTRIBUTED = TOTAL_CONTRIBUTED + msg.value;

        /// keep track of the address' contributions so far
        contributor[msg.sender] = contributionIndex;
        contribution[contributionIndex].addr = msg.sender;
        contribution[contributionIndex].amount += msg.value;
    }

    function airdropPresale() external onlyOwner {

        /// determine the price per token
        uint256 pricePerToken = (TOTAL_CONTRIBUTED * 10 ** 18)/PRESALE_SUPPLY;

        /// loop over each contribution and distribute tokens
        for (uint256 i = 1; i <= NUMBER_OF_CONTRIBUTORS; i++) {

            /// convert contribution to 18 decimals
            uint256 contributionAmount = contribution[i].amount * 10 ** 18;

            /// calculate the percentage of the pool based on the address' contribution
            uint256 numberOfTokensToMint = contributionAmount/pricePerToken;

            /// mint the tokens to the address
            _mint(contribution[i].addr, numberOfTokensToMint);
        }
    }

    /// set whether or not the contract allows contributions
    function setAllowContributions(bool _value) external onlyOwner {
        allowContributions = _value;
    }

    /// if there are not enough contributions, refund everyone their eth
    function refundEveryone() external onlyOwner {
        for (uint256 i = 1; i <= NUMBER_OF_CONTRIBUTORS; i++) {
            address payable refundAddress = payable(contribution[i].addr);
            
            /// refund the contribution
            refundAddress.transfer(contribution[i].amount);
        }
    }

    function startTrading(address _pair) external onlyOwner {
        uniswapV2Pair = _pair;
    }

    /// allows the owner to withdraw the funds in this contract
    function withdrawBalance(address payable _address) external onlyOwner {
        (bool success, ) = _address.call{value: address(this).balance}("");
        require(success, "Withdraw failed");
    }
}