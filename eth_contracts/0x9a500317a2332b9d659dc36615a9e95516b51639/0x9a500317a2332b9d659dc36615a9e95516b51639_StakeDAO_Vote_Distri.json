{"SourceCode": "# @version 0.3.9\r\n\"\"\"\r\n@title StakeDAO Vote Distribution Bot\r\n@license Apache 2.0\r\n@author Volume.finance\r\n\"\"\"\r\ninterface Bot:\r\n    def vote(_gauge_addr: DynArray[address, MAX_SIZE], _user_weight: DynArray[uint256, MAX_SIZE]): nonpayable\r\n\r\nMAX_SIZE: constant(uint256) = 8\r\n\r\nblueprint: public(address)\r\ncompass: public(address)\r\nbot_to_owner: public(HashMap[address, address])\r\nowner_to_bot: public(HashMap[address, address])\r\npaloma: public(bytes32)\r\n\r\nevent UpdateBlueprint:\r\n    old_blueprint: address\r\n    new_blueprint: address\r\n\r\nevent UpdateCompass:\r\n    old_compass: address\r\n    new_compass: address\r\n\r\nevent DeployVoteDistributionBot:\r\n    bot: address\r\n    router: address\r\n    owner: address\r\n\r\nevent Deposited:\r\n    bot: address\r\n    token0: address\r\n    amount0: uint256\r\n    amount1: uint256\r\n    unlock_time: uint256\r\n\r\nevent Claimed:\r\n    bot: address\r\n    out_token: address\r\n    out_amount: uint256\r\n    time_stamp: uint256\r\n\r\nevent Withdrawn:\r\n    bot: address\r\n    sdt_amount: uint256\r\n    out_token: address\r\n    out_amount: uint256\r\n\r\nevent Voted:\r\n    bot: address\r\n    gauge_addr: DynArray[address, MAX_SIZE]\r\n    user_weight: DynArray[uint256, MAX_SIZE]\r\n    time_stamp: uint256\r\n\r\nevent SetPaloma:\r\n    paloma: bytes32\r\n\r\n@external\r\ndef __init__(_blueprint: address, _compass: address):\r\n    self.blueprint = _blueprint\r\n    self.compass = _compass\r\n    log UpdateCompass(empty(address), _compass)\r\n    log UpdateBlueprint(empty(address), _blueprint)\r\n\r\n@external\r\ndef deploy_vote_distribution_bot(router: address):\r\n    assert self.owner_to_bot[msg.sender] == empty(address), \"Already user has bot\"\r\n    bot: address = create_from_blueprint(self.blueprint, router, msg.sender, code_offset=3)\r\n    self.bot_to_owner[bot] = msg.sender\r\n    self.owner_to_bot[msg.sender] = bot\r\n    log DeployVoteDistributionBot(bot, router, msg.sender)\r\n\r\n@external\r\ndef vote(bots: DynArray[address, MAX_SIZE], _gauge_addr: DynArray[address, MAX_SIZE], _user_weight: DynArray[uint256, MAX_SIZE]):\r\n    assert msg.sender == self.compass, \"Not compass\"\r\n    _len: uint256 = len(_gauge_addr)\r\n    assert _len == len(_user_weight), \"Validation error\"\r\n    _len = unsafe_add(unsafe_add(unsafe_mul(unsafe_add(len(bots), 2), 32), unsafe_mul(unsafe_add(_len, 2), 64)), 36)\r\n    assert len(msg.data) == _len, \"Invalid payload\"\r\n    assert self.paloma == convert(slice(msg.data, unsafe_sub(_len, 32), 32), bytes32), \"Invalid paloma\"\r\n    for i in range(MAX_SIZE):\r\n        if i >= len(bots):\r\n            break\r\n        Bot(bots[i]).vote(_gauge_addr, _user_weight)\r\n        log Voted(bots[i], _gauge_addr, _user_weight, block.timestamp)\r\n\r\n@external\r\ndef deposited(token0: address, amount0: uint256, amount1: uint256, unlock_time: uint256):\r\n    assert self.bot_to_owner[msg.sender] != empty(address)\r\n    log Deposited(msg.sender, token0, amount0, amount1, unlock_time)\r\n\r\n@external\r\ndef claimed(out_token: address, amount0: uint256):\r\n    assert self.bot_to_owner[msg.sender] != empty(address)\r\n    log Claimed(msg.sender, out_token, amount0, block.timestamp)\r\n\r\n@external\r\ndef withdrawn(sdt_amount: uint256, out_token: address, amount0: uint256):\r\n    assert self.bot_to_owner[msg.sender] != empty(address)\r\n    log Withdrawn(msg.sender, sdt_amount, out_token, amount0)\r\n\r\n@external\r\ndef update_compass(new_compass: address):\r\n    assert msg.sender == self.compass and len(msg.data) == 68 and convert(slice(msg.data, 36, 32), bytes32) == self.paloma, \"Unauthorized\"\r\n    self.compass = new_compass\r\n    log UpdateCompass(msg.sender, new_compass)\r\n\r\n@external\r\ndef update_blueprint(new_blueprint: address):\r\n    assert msg.sender == self.compass and len(msg.data) == 68 and convert(slice(msg.data, 36, 32), bytes32) == self.paloma, \"Unauthorized\"\r\n    old_blueprint:address = self.blueprint\r\n    self.blueprint = new_blueprint\r\n    log UpdateCompass(old_blueprint, new_blueprint)\r\n\r\n@external\r\ndef set_paloma():\r\n    assert msg.sender == self.compass and self.paloma == empty(bytes32) and len(msg.data) == 36, \"Invalid\"\r\n    _paloma: bytes32 = convert(slice(msg.data, 4, 32), bytes32)\r\n    self.paloma = _paloma\r\n    log SetPaloma(_paloma)", "ABI": "[{\"name\":\"UpdateBlueprint\",\"inputs\":[{\"name\":\"old_blueprint\",\"type\":\"address\",\"indexed\":false},{\"name\":\"new_blueprint\",\"type\":\"address\",\"indexed\":false}],\"anonymous\":false,\"type\":\"event\"},{\"name\":\"UpdateCompass\",\"inputs\":[{\"name\":\"old_compass\",\"type\":\"address\",\"indexed\":false},{\"name\":\"new_compass\",\"type\":\"address\",\"indexed\":false}],\"anonymous\":false,\"type\":\"event\"},{\"name\":\"DeployVoteDistributionBot\",\"inputs\":[{\"name\":\"bot\",\"type\":\"address\",\"indexed\":false},{\"name\":\"router\",\"type\":\"address\",\"indexed\":false},{\"name\":\"owner\",\"type\":\"address\",\"indexed\":false}],\"anonymous\":false,\"type\":\"event\"},{\"name\":\"Deposited\",\"inputs\":[{\"name\":\"bot\",\"type\":\"address\",\"indexed\":false},{\"name\":\"token0\",\"type\":\"address\",\"indexed\":false},{\"name\":\"amount0\",\"type\":\"uint256\",\"indexed\":false},{\"name\":\"amount1\",\"type\":\"uint256\",\"indexed\":false},{\"name\":\"unlock_time\",\"type\":\"uint256\",\"indexed\":false}],\"anonymous\":false,\"type\":\"event\"},{\"name\":\"Claimed\",\"inputs\":[{\"name\":\"bot\",\"type\":\"address\",\"indexed\":false},{\"name\":\"out_token\",\"type\":\"address\",\"indexed\":false},{\"name\":\"out_amount\",\"type\":\"uint256\",\"indexed\":false},{\"name\":\"time_stamp\",\"type\":\"uint256\",\"indexed\":false}],\"anonymous\":false,\"type\":\"event\"},{\"name\":\"Withdrawn\",\"inputs\":[{\"name\":\"bot\",\"type\":\"address\",\"indexed\":false},{\"name\":\"sdt_amount\",\"type\":\"uint256\",\"indexed\":false},{\"name\":\"out_token\",\"type\":\"address\",\"indexed\":false},{\"name\":\"out_amount\",\"type\":\"uint256\",\"indexed\":false}],\"anonymous\":false,\"type\":\"event\"},{\"name\":\"Voted\",\"inputs\":[{\"name\":\"bot\",\"type\":\"address\",\"indexed\":false},{\"name\":\"gauge_addr\",\"type\":\"address[]\",\"indexed\":false},{\"name\":\"user_weight\",\"type\":\"uint256[]\",\"indexed\":false},{\"name\":\"time_stamp\",\"type\":\"uint256\",\"indexed\":false}],\"anonymous\":false,\"type\":\"event\"},{\"name\":\"SetPaloma\",\"inputs\":[{\"name\":\"paloma\",\"type\":\"bytes32\",\"indexed\":false}],\"anonymous\":false,\"type\":\"event\"},{\"stateMutability\":\"nonpayable\",\"type\":\"constructor\",\"inputs\":[{\"name\":\"_blueprint\",\"type\":\"address\"},{\"name\":\"_compass\",\"type\":\"address\"}],\"outputs\":[]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"deploy_vote_distribution_bot\",\"inputs\":[{\"name\":\"router\",\"type\":\"address\"}],\"outputs\":[]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"vote\",\"inputs\":[{\"name\":\"bots\",\"type\":\"address[]\"},{\"name\":\"_gauge_addr\",\"type\":\"address[]\"},{\"name\":\"_user_weight\",\"type\":\"uint256[]\"}],\"outputs\":[]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"deposited\",\"inputs\":[{\"name\":\"token0\",\"type\":\"address\"},{\"name\":\"amount0\",\"type\":\"uint256\"},{\"name\":\"amount1\",\"type\":\"uint256\"},{\"name\":\"unlock_time\",\"type\":\"uint256\"}],\"outputs\":[]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"claimed\",\"inputs\":[{\"name\":\"out_token\",\"type\":\"address\"},{\"name\":\"amount0\",\"type\":\"uint256\"}],\"outputs\":[]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"withdrawn\",\"inputs\":[{\"name\":\"sdt_amount\",\"type\":\"uint256\"},{\"name\":\"out_token\",\"type\":\"address\"},{\"name\":\"amount0\",\"type\":\"uint256\"}],\"outputs\":[]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"update_compass\",\"inputs\":[{\"name\":\"new_compass\",\"type\":\"address\"}],\"outputs\":[]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"update_blueprint\",\"inputs\":[{\"name\":\"new_blueprint\",\"type\":\"address\"}],\"outputs\":[]},{\"stateMutability\":\"nonpayable\",\"type\":\"function\",\"name\":\"set_paloma\",\"inputs\":[],\"outputs\":[]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"blueprint\",\"inputs\":[],\"outputs\":[{\"name\":\"\",\"type\":\"address\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"compass\",\"inputs\":[],\"outputs\":[{\"name\":\"\",\"type\":\"address\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"bot_to_owner\",\"inputs\":[{\"name\":\"arg0\",\"type\":\"address\"}],\"outputs\":[{\"name\":\"\",\"type\":\"address\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"owner_to_bot\",\"inputs\":[{\"name\":\"arg0\",\"type\":\"address\"}],\"outputs\":[{\"name\":\"\",\"type\":\"address\"}]},{\"stateMutability\":\"view\",\"type\":\"function\",\"name\":\"paloma\",\"inputs\":[],\"outputs\":[{\"name\":\"\",\"type\":\"bytes32\"}]}]", "ContractName": "StakeDAO Vote Distribution Bot", "CompilerVersion": "vyper:0.3.9", "OptimizationUsed": "0", "Runs": "0", "ConstructorArguments": "000000000000000000000000ab595f0bf1d7787a0a39243074a820378afe15040000000000000000000000007eec3e2f4d567794b927b6d904fbf973bc8d15e6", "EVMVersion": "Default", "Library": "", "LicenseType": "Apache-2.0", "Proxy": "0", "Implementation": "", "SwarmSource": ""}