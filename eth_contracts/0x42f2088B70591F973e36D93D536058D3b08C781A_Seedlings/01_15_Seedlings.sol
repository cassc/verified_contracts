// SPDX-License-Identifier: MIT
//
//                                                                                           .             ..      . .                                
//                                                                           _.      .        :           =.s    ...:-..                              
//                                                                .         .|+:  ... .-..|_ .:;         =,hi;   .seeed                          ._   
//                                                               .J,.       :++:..       =||; :;...      |vl}:_  .joinn_,               ....:....%hi  
//                          ...                            =;    ."'.       :::.  .     .+|++.:;. . :.  .+|=;--:+=~uss!<3+__...   .__;=:---:::;;=+:|  
//             .        ...:-.:.:.:.. .. . ........       .|+;    ..     ....::-:. .     ||==:.:.    .:::::=~   .;=|I( ...=<|====++- .   . =<i=;:::=| 
//         ...:....    ..._<3%,::.._;. . .:::-:::..... ...====..-... .. .    .-=%.       :=;:see:     .lets:.   :s;=-. :.:seeds,::: .    .=seeds/..:: 
//        ..:==>;-.......-lweareseeds    :.;=%====;;::. .  :;;:;:::.. .     ..]SF..        ..dli:.   . grow;:.:::>::. .-=support;:::    .=magical;.:. 
//       ..tseeds;:.    .:ss!?!!!!!!` . -:=Z%weareall;    .:Trees!>;...     .:]eo:.         :ngs:.    .=lets:. -=Se:. ..<eachOther ; .  .=Cute*|Y';.. 
//      ..-ogrowSe:    ..:we:-.. .. ... ..<#@seedlings.   .=Z#Ofx%Xo%:      ..]er;.        .:are; .  . =seed:::.=ed:.  :seedsGrow2.::   :=GR(+:::<; . 
//      ..:g+:+!1+..    .-gr:.    . ;:.  :)we+++||*!!`[email protected]:.    ..]de=..       .:one:;+=: .:%@!2;=..=li: ..:)[email protected]+:-:::--:=,  ==OW;;.. )( - 
//     ...)e:.:..:...  ...ow:..         .:are:::;;..  .== .=SeedsOfToday. .  :)lv=:        ..big;=||` .:seeds;..%ng:.. :=3(:. .=+:.:|=. .:Ts:.:  . .. 
//      ..)t:....)=..  ...Se:. .    .   ..see:-:;;=.   - .:;<%:.-.:+%gSt.   ..)ie>..        :for:;+: ..support=.=s%;=;.Be;;..  -- -=:-  . |Oe...   .  
//     ...=h>.  .-`.   :..ee::.-..    .=:-edl:.....      -.=We;...-:TrEo:.   .<nr>.        ..est:.-   .=seedsc;:<Gr;+=;The::.. . ..      ..;Ge--...   
//    :=.::e|:.  ...   ...dsShine:.  :==:-ing:.:--       .:are;.  :.<oEg>-. ..=g!>.._       :SGW-    ..<%^2!SG;:=ow;===Cha-::.. .: .. .|=_..{Ed.:..   
//   :=;;.:rjc...       .:BrightX;    :=::s%you==:.     ...the;. . .=wDec.  [email protected]=;=+`     .:ere:.   ::<S2=)#rc;<Tl:--:nge:. .grow;,.:.iii=.:%Tl..:.  
//   -:;: -:3o>:...;   .-:be%kind:.    -::deserve~     .++==Se;..  .:iLt[..:=+=%%hi++.     .:eoA::. .::<eX==3oGrowy;..:You: [email protected]} ..||||:.-%Hi..;= 
//        .:+#ym:===.  ..:weGrow;.  .  -::goood~%(     .+=;:ed:.   ..nIh(..;==sowC;+= .    .:dwr;.  .:.<e2;:+wYourc:. :Wan:...Dreams . |||=`..=%En::::
//         .:{#a;==+.   .:ls:.:==:;|+.  :=thingsS'.     =+;;co;     :gNe;..==;the~.--      .:lTe;.   ..<dk:.:Dreams:...tTo::..:lets:.:;:=::-...+XRg.:-
//    .. ...::Xg;==+   ..:ee:.. :=+++. =:=in=::-...      :::sy=. . .:=Gr>. --:seeds.       .:ioA=. .  .<lg;.:<Into%::.:See>:::;grow!::=:.:>....:)[email protected] 
//    . .e. .:)i>:--    .:te;....+|+|. =:life:.        __.:=st=..-..=3S%(    .of%2t...   . .:ngl;.    .)ir;..:Real~:.. :)}=>;=frens.:==;.:X;::-:=Z(.. 
//   ...=l...::c[..   ._..sd;....===:  ::<Lets. .      |++==em>-.. :<#xZ: .  .tomorrow... ..:gel:.    .)no;::;<ity!:.  .-oneBig#%t(::=+:.:3h::=|uU=.. 
//    . =i..:::a(..  .==..growWithUs=: ..:GROW:.. .    .=+=;=%#=-..:=grOw .   .:grow=;:::;;;.stS%:.    .gwW:::;;seed.  ...=ForestOf; .-:. :)e=join!::  
//    ..-m:treel`.   .==..ti=useeeds;.  :=%H=::.:....  :|;;=#support#[email protected]:-.   .:together%XZc..]he<3! . .:s(..=:.:tR;: ..::.=SEEDS(;..     ..=we&us!.:: 
//     ..sEEdssl:..  .=:. ._dgrowwwF=. ..+Together!;:   --:=eachOtherX(..    ..OneBigTreeZc..iee:;+:   =Y(.   ..{N(. .:;: .-+*|:: .       .-rise(::=: 
//      .gARDens..      ..:TOGETHERa:. ...:seedlings:     :=~be%kindX(..      .ofSeeds?!!!^.."rd::+`   .        -~` .:=: . .. ...          ..:<3:--:  
//      ..-!!+:..       .::--------- .  :.forever<3!:=.  ..=letsgrow+-.       .:=+=----.... . ;s,                  .   .     .              .....     
//        . ...         -== . ..... .   . -=++!!!!?*=|+   .=?Y(|**+:-:;..      .++=... .       .                                                      
//                                       .. .......-+|+ .  ..........=|;       .+=+.                                                                  
//                                          . .  .  -=|.       . .   =++        -==                                                                   
//                                                    .                -                                                                              
// 

pragma solidity ^0.8.7;

import "erc721a/contracts/extensions/ERC721AQueryable.sol";
import "@openzeppelin/contracts/utils/Strings.sol";
import "@openzeppelin/contracts/token/common/ERC2981.sol";
import "@openzeppelin/contracts/utils/math/SafeMath.sol";
import "@openzeppelin/contracts/access/Ownable.sol";
import "@openzeppelin/contracts/security/ReentrancyGuard.sol";
import "@openzeppelin/contracts/utils/cryptography/MerkleProof.sol";

contract Seedlings is ERC721AQueryable, ERC2981, Ownable, ReentrancyGuard {

    using SafeMath for uint256;
 
    bytes32 private alMerkleRoot;
    bytes32 private ogMerkleRoot;

    uint256 public devReserve;

    uint256 public maxSupply; 
    uint256 public maxPerTxn;
    uint256 public alMaxPerWallet;
    uint256 public ogMaxPerWallet;

    uint256 public devMinted;

    bool public isPublicMintEnabled;
    bool public isPrivateMintEnabled;

    string internal baseTokenUri;

    mapping(address => uint256) public alMinted;
    mapping(address => uint256) public ogMinted;

    constructor() payable ERC721A('Seedlings', 'SEED') {

        maxSupply = 10000;
        maxPerTxn = 2;
	alMaxPerWallet = 2;
	ogMaxPerWallet = 3;
        devReserve = 6;
        devMinted = 0;
    }

    function mintEnabled(bool isPublicMintEnabled_, bool isPrivateMintEnabled_) external onlyOwner {

        isPublicMintEnabled = isPublicMintEnabled_;
	isPrivateMintEnabled = isPrivateMintEnabled_;
    }

    function supportsInterface(bytes4 interfaceId) public view virtual override(ERC721A, ERC2981) returns (bool) {

        return super.supportsInterface(interfaceId);
    }

    function setMaxPerTxns(uint256 _maxPerTxn, uint256 _alMaxPerWallet, uint256 _ogMaxPerWallet) external onlyOwner {

        maxPerTxn = _maxPerTxn;
	alMaxPerWallet = _alMaxPerWallet;
	ogMaxPerWallet = _ogMaxPerWallet;
    }

    function setMerkleRoots(bytes32 _alMerkleRoot, bytes32 _ogMerkleRoot) external onlyOwner {

	alMerkleRoot = _alMerkleRoot;
	ogMerkleRoot = _ogMerkleRoot;
    }

    function checkAllowlisted(address _address,bytes32[] calldata _alMerkleProof) public view returns (bool) {

	bytes32 leaf = keccak256(bytes.concat(keccak256(abi.encode(_address))));
	return MerkleProof.verify(_alMerkleProof, alMerkleRoot, leaf);
    }

    function checkOG(address _address,bytes32[] calldata _ogMerkleProof) public view returns (bool) {

        bytes32 leaf = keccak256(bytes.concat(keccak256(abi.encode(_address))));
        return MerkleProof.verify(_ogMerkleProof, ogMerkleRoot, leaf);
    }

    //=====================+
    //         URI         |
    //=====================+
    function setBaseTokenUri(string calldata baseTokenUri_) external onlyOwner {

        baseTokenUri = baseTokenUri_;
    }

    function tokenURI(uint256 tokenId_) public view override returns (string memory) {

        require(_exists(tokenId_), 'Token does not exist');
        return string(abi.encodePacked(baseTokenUri, Strings.toString(tokenId_), ".json"));
    }

    function setDefaultRoyalty(address receiver, uint96 feeNumerator) external onlyOwner {

        _setDefaultRoyalty(receiver, feeNumerator);
    }

    //=====================+
    //       Withdraw      |
    //=====================+
    function withdraw() external payable onlyOwner nonReentrant {

        payable(msg.sender).transfer(address(this).balance);
    }

    //=====================+
    //       Dev Mint      |
    //=====================+
    function devMint(address _receiver, uint256 n) external payable nonReentrant onlyOwner {

        uint256 supply = totalSupply();
        uint256 devSupply = devMinted.add(n);
        require(devSupply <= devReserve, 'dev mint limit reached');
        require(devSupply.add(supply) <= maxSupply, 'max supply reached');
        devMinted = devSupply;

	_safeMint(_receiver, n);
    }

    //=====================+
    //        Mint         |
    //=====================+
    function mint(uint256 quantity_) external payable nonReentrant {

        require(isPublicMintEnabled, 'Minting not enabled');
        require(quantity_ <= maxPerTxn, "Maximum per transaction exceeded.");  
        uint256 ts = totalSupply();
        require(ts.add(quantity_) <= maxSupply, 'Sold out');

    	_safeMint(msg.sender, quantity_);
    }

    function ogMint(bytes32[] calldata _merkleProof, uint256  ogQuantity_) external payable nonReentrant {
        
	require(isPrivateMintEnabled, 'Private Mint is not enabled.');
	uint256 totals = totalSupply();
        require(totals.add(ogQuantity_) <= maxSupply, 'Exceeds maximum supply.');
        require(ogMinted[msg.sender].add(ogQuantity_) <= ogMaxPerWallet, "Maximum OG Mint exceeded.");
	require(checkOG(msg.sender, _merkleProof));
        ogMinted[msg.sender] += ogQuantity_;

        _safeMint(msg.sender, ogQuantity_);
    }

    function allowlistMint(bytes32[] calldata _merkleProof, uint256  alQuantity_) external payable nonReentrant {

    	require(isPrivateMintEnabled, 'Private Mint is not enabled.');
	uint256 totals = totalSupply();
	require(totals.add(alQuantity_) <= maxSupply, 'Exceeds maximum supply.');
	require(alMinted[msg.sender].add(alQuantity_) <= alMaxPerWallet, "Maximum Allowlist Mint exceeded.");
	require(checkAllowlisted(msg.sender, _merkleProof));
	alMinted[msg.sender] += alQuantity_;

	_safeMint(msg.sender, alQuantity_);
    } 
}