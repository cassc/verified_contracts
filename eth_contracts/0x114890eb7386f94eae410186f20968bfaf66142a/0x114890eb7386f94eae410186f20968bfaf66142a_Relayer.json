{"SourceCode": "{{\r\n  \"language\": \"Solidity\",\r\n  \"settings\": {\r\n    \"viaIR\": false,\r\n    \"optimizer\": {\r\n      \"runs\": 999999,\r\n      \"enabled\": true\r\n    },\r\n    \"metadata\": {\r\n      \"useLiteralContent\": false,\r\n      \"bytecodeHash\": \"ipfs\"\r\n    },\r\n    \"outputSelection\": {\r\n      \"*\": {\r\n        \"*\": [\r\n          \"evm.bytecode\",\r\n          \"evm.deployedBytecode\",\r\n          \"devdoc\",\r\n          \"userdoc\",\r\n          \"metadata\",\r\n          \"abi\"\r\n        ]\r\n      }\r\n    },\r\n    \"evmVersion\": \"london\",\r\n    \"libraries\": {},\r\n    \"remappings\": [\r\n      \"subapi/=lib/subapi/\",\r\n      \"ORMP/=lib/ORMP/\",\r\n      \"@darwinia-msgport/=lib/darwinia-msgport/\",\r\n      \"@openzeppelin/contracts@4.9.2/=lib/openzeppelin-contracts/contracts/\",\r\n      \"@openzeppelin/contracts/=lib/openzeppelin-contracts/contracts/\",\r\n      \"@safe-smart-account/=lib/subapi/lib/safe-smart-account/contracts/\",\r\n      \"@sphinx-labs/contracts/=lib/sphinx/packages/contracts/contracts/foundry/\",\r\n      \"forge-std/=lib/forge-std/src/\",\r\n      \"solmate/=lib/darwinia-msgport/lib/solmate/src/\",\r\n      \"create3-deploy/=lib/create3-deploy/\"\r\n    ]\r\n  },\r\n  \"sources\": {\r\n    \"lib/ORMP/src/Common.sol\": {\r\n      \"content\": \"// SPDX-License-Identifier: MIT\\npragma solidity 0.8.17;\\n\\n/// @dev The block of control information and data for comminicate\\n/// between user applications. Messages are the exchange medium\\n/// used by channels to send and receive data through cross-chain networks.\\n/// A message is sent from a source chain to a destination chain.\\n/// @param index The leaf index lives in channel's incremental mekle tree.\\n/// @param fromChainId The message source chain id.\\n/// @param from User application contract address which send the message.\\n/// @param toChainId The message destination chain id.\\n/// @param to User application contract address which receive the message.\\n/// @param gasLimit Gas limit for destination UA used.\\n/// @param encoded The calldata which encoded by ABI Encoding.\\nstruct Message {\\n    address channel;\\n    uint256 index;\\n    uint256 fromChainId;\\n    address from;\\n    uint256 toChainId;\\n    address to;\\n    uint256 gasLimit;\\n    bytes encoded; /*(abi.encodePacked(SELECTOR, PARAMS))*/\\n}\\n\\n/// @dev Hash of the message.\\nfunction hash(Message memory message) pure returns (bytes32) {\\n    return keccak256(abi.encode(message));\\n}\\n\"\r\n    },\r\n    \"lib/ORMP/src/eco/Relayer.sol\": {\r\n      \"content\": \"// SPDX-License-Identifier: MIT\\npragma solidity 0.8.17;\\n\\nimport \\\"../interfaces/IORMP.sol\\\";\\n\\ncontract Relayer {\\n    event SetDstPrice(uint256 indexed chainId, uint128 dstPriceRatio, uint128 dstGasPriceInWei);\\n    event SetDstConfig(uint256 indexed chainId, uint64 baseGas, uint64 gasPerByte);\\n    event SetApproved(address operator, bool approve);\\n    event OwnershipTransferred(address indexed previousOwner, address indexed newOwner);\\n\\n    struct DstPrice {\\n        uint128 dstPriceRatio; // dstPrice / localPrice * 10^10\\n        uint128 dstGasPriceInWei;\\n    }\\n\\n    struct DstConfig {\\n        uint64 baseGas;\\n        uint64 gasPerByte;\\n    }\\n\\n    address public immutable PROTOCOL;\\n\\n    address public owner;\\n    // chainId => price\\n    mapping(uint256 => DstPrice) public priceOf;\\n    mapping(uint256 => DstConfig) public configOf;\\n    mapping(address => bool) public approvedOf;\\n\\n    modifier onlyOwner() {\\n        require(msg.sender == owner, \\\"!owner\\\");\\n        _;\\n    }\\n\\n    modifier onlyApproved() {\\n        require(isApproved(msg.sender), \\\"!approve\\\");\\n        _;\\n    }\\n\\n    constructor(address dao, address ormp) {\\n        PROTOCOL = ormp;\\n        owner = dao;\\n    }\\n\\n    function version() public pure returns (string memory) {\\n        return \\\"2.1.0\\\";\\n    }\\n\\n    receive() external payable {}\\n\\n    function withdraw(address to, uint256 amount) external onlyApproved {\\n        (bool success,) = to.call{value: amount}(\\\"\\\");\\n        require(success, \\\"!withdraw\\\");\\n    }\\n\\n    function isApproved(address operator) public view returns (bool) {\\n        return approvedOf[operator];\\n    }\\n\\n    function changeOwner(address newOwner) external onlyOwner {\\n        address oldOwner = owner;\\n        owner = newOwner;\\n        emit OwnershipTransferred(oldOwner, newOwner);\\n    }\\n\\n    function setApproved(address operator, bool approve) public onlyOwner {\\n        approvedOf[operator] = approve;\\n        emit SetApproved(operator, approve);\\n    }\\n\\n    function setDstPrice(uint256 chainId, uint128 dstPriceRatio, uint128 dstGasPriceInWei) external onlyApproved {\\n        priceOf[chainId] = DstPrice(dstPriceRatio, dstGasPriceInWei);\\n        emit SetDstPrice(chainId, dstPriceRatio, dstGasPriceInWei);\\n    }\\n\\n    function setDstConfig(uint256 chainId, uint64 baseGas, uint64 gasPerByte) external onlyApproved {\\n        configOf[chainId] = DstConfig(baseGas, gasPerByte);\\n        emit SetDstConfig(chainId, baseGas, gasPerByte);\\n    }\\n\\n    // extraGas = gasLimit\\n    function fee(\\n        uint256 toChainId,\\n        address, /*ua*/\\n        uint256 gasLimit,\\n        bytes calldata encoded,\\n        bytes calldata /*params*/\\n    ) public view returns (uint256) {\\n        uint256 size = encoded.length;\\n        uint256 extraGas = gasLimit;\\n        DstPrice memory p = priceOf[toChainId];\\n        DstConfig memory c = configOf[toChainId];\\n\\n        require(c.baseGas != 0, \\\"!baseGas\\\");\\n        // remoteToken = dstGasPriceInWei * (baseGas + extraGas)\\n        uint256 remoteToken = p.dstGasPriceInWei * (c.baseGas + extraGas);\\n        // dstPriceRatio = dstPrice / localPrice * 10^10\\n        // sourceToken = RemoteToken * dstPriceRatio\\n        uint256 sourceToken = remoteToken * p.dstPriceRatio / (10 ** 10);\\n        uint256 payloadToken = c.gasPerByte * size * p.dstGasPriceInWei * p.dstPriceRatio / (10 ** 10);\\n        return sourceToken + payloadToken;\\n    }\\n\\n    function relay(Message calldata message) external onlyApproved {\\n        IORMP(PROTOCOL).recv(message, \\\"\\\");\\n    }\\n}\\n\"\r\n    },\r\n    \"lib/ORMP/src/interfaces/IORMP.sol\": {\r\n      \"content\": \"// SPDX-License-Identifier: MIT\\npragma solidity 0.8.17;\\n\\nimport \\\"../Common.sol\\\";\\n\\ninterface IORMP {\\n    /// @dev Send a cross-chain message over the endpoint.\\n    /// @notice follow https://eips.ethereum.org/EIPS/eip-5750\\n    /// @param toChainId The Message destination chain id.\\n    /// @param to User application contract address which receive the message.\\n    /// @param gasLimit Gas limit for destination user application used.\\n    /// @param encoded The calldata which encoded by ABI Encoding.\\n    /// @param refund Return extra fee to refund address.\\n    /// @return Return the hash of the message as message id.\\n    /// @param params General extensibility for relayer to custom functionality.\\n    function send(\\n        uint256 toChainId,\\n        address to,\\n        uint256 gasLimit,\\n        bytes calldata encoded,\\n        address refund,\\n        bytes calldata params\\n    ) external payable returns (bytes32);\\n\\n    /// @notice Get a quote in source native gas, for the amount that send() requires to pay for message delivery.\\n    /// @param toChainId The Message destination chain id.\\n    //  @param ua User application contract address which send the message.\\n    /// @param gasLimit Gas limit for destination user application used.\\n    /// @param encoded The calldata which encoded by ABI Encoding.\\n    /// @param params General extensibility for relayer to custom functionality.\\n    function fee(uint256 toChainId, address ua, uint256 gasLimit, bytes calldata encoded, bytes calldata params)\\n        external\\n        view\\n        returns (uint256);\\n\\n    /// @dev Recv verified message and dispatch to destination user application address.\\n    /// @param message Verified receive message info.\\n    /// @param proof Message proof of this message.\\n    /// @return dispatchResult Result of the message dispatch.\\n    function recv(Message calldata message, bytes calldata proof) external payable returns (bool dispatchResult);\\n\\n    /// @dev Fetch user application config.\\n    /// @notice If user application has not configured, then the default config is used.\\n    /// @param ua User application contract address.\\n    function getAppConfig(address ua) external view returns (address oracle, address relayer);\\n\\n    /// @notice Set user application config.\\n    /// @param oracle Oracle which user application choose.\\n    /// @param relayer Relayer which user application choose.\\n    function setAppConfig(address oracle, address relayer) external;\\n\\n    function defaultUC() external view returns (address oracle, address relayer);\\n\\n    /// @dev Check the msg if it is dispatched.\\n    /// @param msgHash Hash of the checked message.\\n    /// @return Return the dispatched result of the checked message.\\n    function dones(bytes32 msgHash) external view returns (bool);\\n\\n    /// @dev Import hash by any oracle address.\\n    /// @notice Hash is an abstract of the proof system, it can be a block hash or a message root hash,\\n    ///  \\t\\tspecifically provided by oracles.\\n    /// @param chainId The source chain id.\\n    /// @param channel The message channel.\\n    /// @param msgIndex The source chain message index.\\n    /// @param hash_ The hash to import.\\n    function importHash(uint256 chainId, address channel, uint256 msgIndex, bytes32 hash_) external;\\n\\n    /// @dev Fetch hash.\\n    /// @param oracle The oracle address.\\n    /// @param lookupKey The key for loop up hash.\\n    /// @return Return the hash imported by the oracle.\\n    function hashLookup(address oracle, bytes32 lookupKey) external view returns (bytes32);\\n}\\n\"\r\n    }\r\n  }\r\n}}", "ABI": "[{\"inputs\":[{\"internalType\":\"address\",\"name\":\"dao\",\"type\":\"address\"},{\"internalType\":\"address\",\"name\":\"ormp\",\"type\":\"address\"}],\"stateMutability\":\"nonpayable\",\"type\":\"constructor\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"address\",\"name\":\"previousOwner\",\"type\":\"address\"},{\"indexed\":true,\"internalType\":\"address\",\"name\":\"newOwner\",\"type\":\"address\"}],\"name\":\"OwnershipTransferred\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":false,\"internalType\":\"address\",\"name\":\"operator\",\"type\":\"address\"},{\"indexed\":false,\"internalType\":\"bool\",\"name\":\"approve\",\"type\":\"bool\"}],\"name\":\"SetApproved\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"uint256\",\"name\":\"chainId\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint64\",\"name\":\"baseGas\",\"type\":\"uint64\"},{\"indexed\":false,\"internalType\":\"uint64\",\"name\":\"gasPerByte\",\"type\":\"uint64\"}],\"name\":\"SetDstConfig\",\"type\":\"event\"},{\"anonymous\":false,\"inputs\":[{\"indexed\":true,\"internalType\":\"uint256\",\"name\":\"chainId\",\"type\":\"uint256\"},{\"indexed\":false,\"internalType\":\"uint128\",\"name\":\"dstPriceRatio\",\"type\":\"uint128\"},{\"indexed\":false,\"internalType\":\"uint128\",\"name\":\"dstGasPriceInWei\",\"type\":\"uint128\"}],\"name\":\"SetDstPrice\",\"type\":\"event\"},{\"inputs\":[],\"name\":\"PROTOCOL\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"name\":\"approvedOf\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"newOwner\",\"type\":\"address\"}],\"name\":\"changeOwner\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"configOf\",\"outputs\":[{\"internalType\":\"uint64\",\"name\":\"baseGas\",\"type\":\"uint64\"},{\"internalType\":\"uint64\",\"name\":\"gasPerByte\",\"type\":\"uint64\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"toChainId\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"gasLimit\",\"type\":\"uint256\"},{\"internalType\":\"bytes\",\"name\":\"encoded\",\"type\":\"bytes\"},{\"internalType\":\"bytes\",\"name\":\"\",\"type\":\"bytes\"}],\"name\":\"fee\",\"outputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"operator\",\"type\":\"address\"}],\"name\":\"isApproved\",\"outputs\":[{\"internalType\":\"bool\",\"name\":\"\",\"type\":\"bool\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"owner\",\"outputs\":[{\"internalType\":\"address\",\"name\":\"\",\"type\":\"address\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"\",\"type\":\"uint256\"}],\"name\":\"priceOf\",\"outputs\":[{\"internalType\":\"uint128\",\"name\":\"dstPriceRatio\",\"type\":\"uint128\"},{\"internalType\":\"uint128\",\"name\":\"dstGasPriceInWei\",\"type\":\"uint128\"}],\"stateMutability\":\"view\",\"type\":\"function\"},{\"inputs\":[{\"components\":[{\"internalType\":\"address\",\"name\":\"channel\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"index\",\"type\":\"uint256\"},{\"internalType\":\"uint256\",\"name\":\"fromChainId\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"from\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"toChainId\",\"type\":\"uint256\"},{\"internalType\":\"address\",\"name\":\"to\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"gasLimit\",\"type\":\"uint256\"},{\"internalType\":\"bytes\",\"name\":\"encoded\",\"type\":\"bytes\"}],\"internalType\":\"struct Message\",\"name\":\"message\",\"type\":\"tuple\"}],\"name\":\"relay\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"operator\",\"type\":\"address\"},{\"internalType\":\"bool\",\"name\":\"approve\",\"type\":\"bool\"}],\"name\":\"setApproved\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"chainId\",\"type\":\"uint256\"},{\"internalType\":\"uint64\",\"name\":\"baseGas\",\"type\":\"uint64\"},{\"internalType\":\"uint64\",\"name\":\"gasPerByte\",\"type\":\"uint64\"}],\"name\":\"setDstConfig\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"uint256\",\"name\":\"chainId\",\"type\":\"uint256\"},{\"internalType\":\"uint128\",\"name\":\"dstPriceRatio\",\"type\":\"uint128\"},{\"internalType\":\"uint128\",\"name\":\"dstGasPriceInWei\",\"type\":\"uint128\"}],\"name\":\"setDstPrice\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"inputs\":[],\"name\":\"version\",\"outputs\":[{\"internalType\":\"string\",\"name\":\"\",\"type\":\"string\"}],\"stateMutability\":\"pure\",\"type\":\"function\"},{\"inputs\":[{\"internalType\":\"address\",\"name\":\"to\",\"type\":\"address\"},{\"internalType\":\"uint256\",\"name\":\"amount\",\"type\":\"uint256\"}],\"name\":\"withdraw\",\"outputs\":[],\"stateMutability\":\"nonpayable\",\"type\":\"function\"},{\"stateMutability\":\"payable\",\"type\":\"receive\"}]", "ContractName": "Relayer", "CompilerVersion": "v0.8.17+commit.8df45f5f", "OptimizationUsed": "1", "Runs": "999999", "ConstructorArguments": "000000000000000000000000040f331774ed6bb161412b4cedb1358b382af3a500000000000000000000000013b2211a7ca45db2808f6db05557ce5347e3634e", "EVMVersion": "london", "Library": "", "LicenseType": "", "Proxy": "0", "Implementation": "", "SwarmSource": ""}